<!DOCTYPE html><html><head><title>cart.factory.js</title><meta http-equiv="Content-Type" content="text/html" charset="UTF-8"><link rel="stylesheet" media="all" href="../../../docco.css"></head><body><div id="container"><div id="background"></div><div id="jump_to">Jump To &hellip;<div id="jump_wrapper"><div id="jump_page"><a href="../../../index.html" class="source"><span class="file_name">README</span></a><a href="../../../Gruntfile.js.html" class="source "><span class="base_path">. / </span><span class="file_name">Gruntfile.js</span></a><a href="../../../client/app/about/about.controller.js.html" class="source "><span class="base_path">client / app / about / </span><span class="file_name">about.controller.js</span></a><a href="../../../client/app/about/about.controller.spec.js.html" class="source "><span class="base_path">client / app / about / </span><span class="file_name">about.controller.spec.js</span></a><a href="../../../client/app/about/about.js.html" class="source "><span class="base_path">client / app / about / </span><span class="file_name">about.js</span></a><a href="../../../client/app/account/account.js.html" class="source "><span class="base_path">client / app / account / </span><span class="file_name">account.js</span></a><a href="../../../client/app/account/login/login.controller.js.html" class="source "><span class="base_path">client / app / account / login / </span><span class="file_name">login.controller.js</span></a><a href="../../../client/app/account/settings/settings.controller.js.html" class="source "><span class="base_path">client / app / account / settings / </span><span class="file_name">settings.controller.js</span></a><a href="../../../client/app/account/signup/signup.controller.js.html" class="source "><span class="base_path">client / app / account / signup / </span><span class="file_name">signup.controller.js</span></a><a href="../../../client/app/admin/admin.controller.js.html" class="source "><span class="base_path">client / app / admin / </span><span class="file_name">admin.controller.js</span></a><a href="../../../client/app/admin/admin.js.html" class="source "><span class="base_path">client / app / admin / </span><span class="file_name">admin.js</span></a><a href="../../../client/app/app.js.html" class="source "><span class="base_path">client / app / </span><span class="file_name">app.js</span></a><a href="../../../client/app/cart/cart.controller.js.html" class="source "><span class="base_path">client / app / cart / </span><span class="file_name">cart.controller.js</span></a><a href="../../../client/app/cart/cart.controller.spec.js.html" class="source "><span class="base_path">client / app / cart / </span><span class="file_name">cart.controller.spec.js</span></a><a href="../../../client/app/cart/cart.factory.js.html" class="source selected"><span class="base_path">client / app / cart / </span><span class="file_name">cart.factory.js</span></a><a href="../../../client/app/cart/cart.js.html" class="source "><span class="base_path">client / app / cart / </span><span class="file_name">cart.js</span></a><a href="../../../client/app/catalog/catalog.controller.js.html" class="source "><span class="base_path">client / app / catalog / </span><span class="file_name">catalog.controller.js</span></a><a href="../../../client/app/catalog/catalog.controller.spec.js.html" class="source "><span class="base_path">client / app / catalog / </span><span class="file_name">catalog.controller.spec.js</span></a><a href="../../../client/app/catalog/catalog.js.html" class="source "><span class="base_path">client / app / catalog / </span><span class="file_name">catalog.js</span></a><a href="../../../client/app/main/main.controller.js.html" class="source "><span class="base_path">client / app / main / </span><span class="file_name">main.controller.js</span></a><a href="../../../client/app/main/main.controller.spec.js.html" class="source "><span class="base_path">client / app / main / </span><span class="file_name">main.controller.spec.js</span></a><a href="../../../client/app/main/main.js.html" class="source "><span class="base_path">client / app / main / </span><span class="file_name">main.js</span></a><a href="../../../client/app/product/product.controller.js.html" class="source "><span class="base_path">client / app / product / </span><span class="file_name">product.controller.js</span></a><a href="../../../client/app/product/product.controller.spec.js.html" class="source "><span class="base_path">client / app / product / </span><span class="file_name">product.controller.spec.js</span></a><a href="../../../client/app/product/product.js.html" class="source "><span class="base_path">client / app / product / </span><span class="file_name">product.js</span></a><a href="../../../client/app/vendor/vendor.controller.js.html" class="source "><span class="base_path">client / app / vendor / </span><span class="file_name">vendor.controller.js</span></a><a href="../../../client/app/vendor/vendor.controller.spec.js.html" class="source "><span class="base_path">client / app / vendor / </span><span class="file_name">vendor.controller.spec.js</span></a><a href="../../../client/app/vendor/vendor.js.html" class="source "><span class="base_path">client / app / vendor / </span><span class="file_name">vendor.js</span></a><a href="../../../client/components/auth/auth.service.js.html" class="source "><span class="base_path">client / components / auth / </span><span class="file_name">auth.service.js</span></a><a href="../../../client/components/auth/user.service.js.html" class="source "><span class="base_path">client / components / auth / </span><span class="file_name">user.service.js</span></a><a href="../../../client/components/auth/vendor/vendor.service.js.html" class="source "><span class="base_path">client / components / auth / vendor / </span><span class="file_name">vendor.service.js</span></a><a href="../../../client/components/auth/vendor/vendor.service.spec.js.html" class="source "><span class="base_path">client / components / auth / vendor / </span><span class="file_name">vendor.service.spec.js</span></a><a href="../../../client/components/modal/modal.service.js.html" class="source "><span class="base_path">client / components / modal / </span><span class="file_name">modal.service.js</span></a><a href="../../../client/components/mongoose-error/mongoose-error.directive.js.html" class="source "><span class="base_path">client / components / mongoose-error / </span><span class="file_name">mongoose-error.directive.js</span></a><a href="../../../client/components/navbar/navbar.controller.js.html" class="source "><span class="base_path">client / components / navbar / </span><span class="file_name">navbar.controller.js</span></a><a href="../../../client/components/socket/socket.io.js.html" class="source "><span class="base_path">client / components / socket / </span><span class="file_name">socket.io.js</span></a><a href="../../../client/components/socket/socket.mock.js.html" class="source "><span class="base_path">client / components / socket / </span><span class="file_name">socket.mock.js</span></a><a href="../../../client/components/socket/socket.service.js.html" class="source "><span class="base_path">client / components / socket / </span><span class="file_name">socket.service.js</span></a><a href="../../../karma.conf.js.html" class="source "><span class="base_path">. / </span><span class="file_name">karma.conf.js</span></a><a href="../../../protractor.conf.js.html" class="source "><span class="base_path">. / </span><span class="file_name">protractor.conf.js</span></a><a href="../../../server/api/amazon/index.js.html" class="source "><span class="base_path">server / api / amazon / </span><span class="file_name">index.js</span></a><a href="../../../server/api/amazon/product.controller.js.html" class="source "><span class="base_path">server / api / amazon / </span><span class="file_name">product.controller.js</span></a><a href="../../../server/api/amazon/product.model.js.html" class="source "><span class="base_path">server / api / amazon / </span><span class="file_name">product.model.js</span></a><a href="../../../server/api/amazon/product.socket.js.html" class="source "><span class="base_path">server / api / amazon / </span><span class="file_name">product.socket.js</span></a><a href="../../../server/api/amazon/product.spec.js.html" class="source "><span class="base_path">server / api / amazon / </span><span class="file_name">product.spec.js</span></a><a href="../../../server/api/amazonCart/index.js.html" class="source "><span class="base_path">server / api / amazonCart / </span><span class="file_name">index.js</span></a><a href="../../../server/api/amazonCart/product.controller.js.html" class="source "><span class="base_path">server / api / amazonCart / </span><span class="file_name">product.controller.js</span></a><a href="../../../server/api/amazonCart/product.model.js.html" class="source "><span class="base_path">server / api / amazonCart / </span><span class="file_name">product.model.js</span></a><a href="../../../server/api/amazonCart/product.socket.js.html" class="source "><span class="base_path">server / api / amazonCart / </span><span class="file_name">product.socket.js</span></a><a href="../../../server/api/amazonCart/product.spec.js.html" class="source "><span class="base_path">server / api / amazonCart / </span><span class="file_name">product.spec.js</span></a><a href="../../../server/api/buyer/buyer.controller.js.html" class="source "><span class="base_path">server / api / buyer / </span><span class="file_name">buyer.controller.js</span></a><a href="../../../server/api/buyer/buyer.model.js.html" class="source "><span class="base_path">server / api / buyer / </span><span class="file_name">buyer.model.js</span></a><a href="../../../server/api/buyer/buyer.model.spec.js.html" class="source "><span class="base_path">server / api / buyer / </span><span class="file_name">buyer.model.spec.js</span></a><a href="../../../server/api/buyer/index.js.html" class="source "><span class="base_path">server / api / buyer / </span><span class="file_name">index.js</span></a><a href="../../../server/api/cart/cart.controller.js.html" class="source "><span class="base_path">server / api / cart / </span><span class="file_name">cart.controller.js</span></a><a href="../../../server/api/cart/cart.model.js.html" class="source "><span class="base_path">server / api / cart / </span><span class="file_name">cart.model.js</span></a><a href="../../../server/api/cart/cart.socket.js.html" class="source "><span class="base_path">server / api / cart / </span><span class="file_name">cart.socket.js</span></a><a href="../../../server/api/cart/cart.spec.js.html" class="source "><span class="base_path">server / api / cart / </span><span class="file_name">cart.spec.js</span></a><a href="../../../server/api/cart/index.js.html" class="source "><span class="base_path">server / api / cart / </span><span class="file_name">index.js</span></a><a href="../../../server/api/product/index.js.html" class="source "><span class="base_path">server / api / product / </span><span class="file_name">index.js</span></a><a href="../../../server/api/product/product.controller.js.html" class="source "><span class="base_path">server / api / product / </span><span class="file_name">product.controller.js</span></a><a href="../../../server/api/product/product.model.js.html" class="source "><span class="base_path">server / api / product / </span><span class="file_name">product.model.js</span></a><a href="../../../server/api/product/product.socket.js.html" class="source "><span class="base_path">server / api / product / </span><span class="file_name">product.socket.js</span></a><a href="../../../server/api/product/product.spec.js.html" class="source "><span class="base_path">server / api / product / </span><span class="file_name">product.spec.js</span></a><a href="../../../server/api/showroom/index.js.html" class="source "><span class="base_path">server / api / showroom / </span><span class="file_name">index.js</span></a><a href="../../../server/api/showroom/showroom.controller.js.html" class="source "><span class="base_path">server / api / showroom / </span><span class="file_name">showroom.controller.js</span></a><a href="../../../server/api/showroom/showroom.model.js.html" class="source "><span class="base_path">server / api / showroom / </span><span class="file_name">showroom.model.js</span></a><a href="../../../server/api/showroom/showroom.socket.js.html" class="source "><span class="base_path">server / api / showroom / </span><span class="file_name">showroom.socket.js</span></a><a href="../../../server/api/showroom/showroom.spec.js.html" class="source "><span class="base_path">server / api / showroom / </span><span class="file_name">showroom.spec.js</span></a><a href="../../../server/api/thing/index.js.html" class="source "><span class="base_path">server / api / thing / </span><span class="file_name">index.js</span></a><a href="../../../server/api/thing/thing.controller.js.html" class="source "><span class="base_path">server / api / thing / </span><span class="file_name">thing.controller.js</span></a><a href="../../../server/api/thing/thing.model.js.html" class="source "><span class="base_path">server / api / thing / </span><span class="file_name">thing.model.js</span></a><a href="../../../server/api/thing/thing.socket.js.html" class="source "><span class="base_path">server / api / thing / </span><span class="file_name">thing.socket.js</span></a><a href="../../../server/api/thing/thing.spec.js.html" class="source "><span class="base_path">server / api / thing / </span><span class="file_name">thing.spec.js</span></a><a href="../../../server/api/user/index.js.html" class="source "><span class="base_path">server / api / user / </span><span class="file_name">index.js</span></a><a href="../../../server/api/user/user.controller.js.html" class="source "><span class="base_path">server / api / user / </span><span class="file_name">user.controller.js</span></a><a href="../../../server/api/user/user.model.js.html" class="source "><span class="base_path">server / api / user / </span><span class="file_name">user.model.js</span></a><a href="../../../server/api/user/user.model.spec.js.html" class="source "><span class="base_path">server / api / user / </span><span class="file_name">user.model.spec.js</span></a><a href="../../../server/api/vendor/index.js.html" class="source "><span class="base_path">server / api / vendor / </span><span class="file_name">index.js</span></a><a href="../../../server/api/vendor/vendor.controller.js.html" class="source "><span class="base_path">server / api / vendor / </span><span class="file_name">vendor.controller.js</span></a><a href="../../../server/api/vendor/vendor.model.js.html" class="source "><span class="base_path">server / api / vendor / </span><span class="file_name">vendor.model.js</span></a><a href="../../../server/api/vendor/vendor.socket.js.html" class="source "><span class="base_path">server / api / vendor / </span><span class="file_name">vendor.socket.js</span></a><a href="../../../server/api/vendor/vendor.spec.js.html" class="source "><span class="base_path">server / api / vendor / </span><span class="file_name">vendor.spec.js</span></a><a href="../../../server/app.js.html" class="source "><span class="base_path">server / </span><span class="file_name">app.js</span></a><a href="../../../server/auth/auth.service.js.html" class="source "><span class="base_path">server / auth / </span><span class="file_name">auth.service.js</span></a><a href="../../../server/auth/facebook/index.js.html" class="source "><span class="base_path">server / auth / facebook / </span><span class="file_name">index.js</span></a><a href="../../../server/auth/facebook/passport.js.html" class="source "><span class="base_path">server / auth / facebook / </span><span class="file_name">passport.js</span></a><a href="../../../server/auth/google/index.js.html" class="source "><span class="base_path">server / auth / google / </span><span class="file_name">index.js</span></a><a href="../../../server/auth/google/passport.js.html" class="source "><span class="base_path">server / auth / google / </span><span class="file_name">passport.js</span></a><a href="../../../server/auth/index.js.html" class="source "><span class="base_path">server / auth / </span><span class="file_name">index.js</span></a><a href="../../../server/auth/local/index.js.html" class="source "><span class="base_path">server / auth / local / </span><span class="file_name">index.js</span></a><a href="../../../server/auth/local/passport.js.html" class="source "><span class="base_path">server / auth / local / </span><span class="file_name">passport.js</span></a><a href="../../../server/auth/twitter/index.js.html" class="source "><span class="base_path">server / auth / twitter / </span><span class="file_name">index.js</span></a><a href="../../../server/auth/twitter/passport.js.html" class="source "><span class="base_path">server / auth / twitter / </span><span class="file_name">passport.js</span></a><a href="../../../server/components/errors/index.js.html" class="source "><span class="base_path">server / components / errors / </span><span class="file_name">index.js</span></a><a href="../../../server/config/environment/development.js.html" class="source "><span class="base_path">server / config / environment / </span><span class="file_name">development.js</span></a><a href="../../../server/config/environment/index.js.html" class="source "><span class="base_path">server / config / environment / </span><span class="file_name">index.js</span></a><a href="../../../server/config/environment/production.js.html" class="source "><span class="base_path">server / config / environment / </span><span class="file_name">production.js</span></a><a href="../../../server/config/environment/test.js.html" class="source "><span class="base_path">server / config / environment / </span><span class="file_name">test.js</span></a><a href="../../../server/config/express.js.html" class="source "><span class="base_path">server / config / </span><span class="file_name">express.js</span></a><a href="../../../server/config/local.env.js.html" class="source "><span class="base_path">server / config / </span><span class="file_name">local.env.js</span></a><a href="../../../server/config/seed.js.html" class="source "><span class="base_path">server / config / </span><span class="file_name">seed.js</span></a><a href="../../../server/config/socketio.js.html" class="source "><span class="base_path">server / config / </span><span class="file_name">socketio.js</span></a><a href="../../../server/routes.js.html" class="source "><span class="base_path">server / </span><span class="file_name">routes.js</span></a><a href="../../../server.js.html" class="source "><span class="base_path">. / </span><span class="file_name">server.js</span></a></div></div></div><table cellpadding="0" cellspacing="0"><thead><tr><th class="docs"><h1>cart.factory.js</h1><div class="filepath">client/app/cart/</div></th><th class="code"></th></tr></thead><tbody><tr id="section-1"><td class="docs"><div class="pilwrap"><a href="#section-1" class="pilcrow">&#182;</a></div>
</td><td class="code"><div class="highlight"><pre><span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">&#39;thesisApp&#39;</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">factory</span><span class="p">(</span><span class="s1">&#39;cartFactory&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;$http&#39;</span><span class="p">,</span> <span class="s1">&#39;Auth&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$http</span><span class="p">,</span> <span class="nx">Auth</span><span class="p">)</span> <span class="p">{</span></pre></div></td></tr><tr id="section-2"><td class="docs"><div class="pilwrap"><a href="#section-2" class="pilcrow">&#182;</a></div><p>console.log(Auth.getCurrentUser(), "CURRENTUSER")</p>
</td><td class="code"><div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">cart</span> <span class="o">=</span> <span class="p">{};</span></pre></div></td></tr><tr id="section-3"><td class="docs"><div class="pilwrap"><a href="#section-3" class="pilcrow">&#182;</a></div><p>add item to db</p>
</td><td class="code"><div class="highlight"><pre>    <span class="nx">cart</span><span class="p">.</span><span class="nx">addItem</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">items</span><span class="p">,</span> <span class="nx">item</span><span class="p">,</span> <span class="nx">user</span><span class="p">)</span> <span class="p">{</span></pre></div></td></tr><tr id="section-4"><td class="docs"><div class="pilwrap"><a href="#section-4" class="pilcrow">&#182;</a></div><p>push item into local item array</p>
</td><td class="code"><div class="highlight"><pre>      <span class="nx">items</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">item</span><span class="p">);</span></pre></div></td></tr><tr id="section-5"><td class="docs"><div class="pilwrap"><a href="#section-5" class="pilcrow">&#182;</a></div><p>if it's the first item create a row</p>
</td><td class="code"><div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="nx">items</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">$http</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="s1">&#39;/api/carts/name/&#39;</span> <span class="o">+</span> <span class="nx">user</span><span class="p">,</span> <span class="nx">items</span><span class="p">)</span>
          <span class="p">.</span><span class="nx">success</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;successful res  from client create&#39;</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span>

          <span class="p">})</span>
          <span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;ERROR from client Create: &quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
          <span class="p">})</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span></pre></div></td></tr><tr id="section-6"><td class="docs"><div class="pilwrap"><a href="#section-6" class="pilcrow">&#182;</a></div><p>if  not the first item update  the row</p>
</td><td class="code"><div class="highlight"><pre>        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">items</span><span class="p">,</span> <span class="s2">&quot;ITEMS IN CLIENT UPDATE&quot;</span><span class="p">)</span>

        <span class="nx">$http</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/api/carts/name/&#39;</span> <span class="o">+</span> <span class="nx">user</span><span class="p">,</span> <span class="nx">items</span><span class="p">)</span>
          <span class="p">.</span><span class="nx">success</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;successful res  from client&#39;</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span>

          <span class="p">})</span>
          <span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;ERROR: &quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
          <span class="p">})</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">items</span>
    <span class="p">};</span></pre></div></td></tr><tr id="section-7"><td class="docs"><div class="pilwrap"><a href="#section-7" class="pilcrow">&#182;</a></div><p>removes item locally and from db</p>
</td><td class="code"><div class="highlight"><pre>    <span class="nx">cart</span><span class="p">.</span><span class="nx">removeItem</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">items</span><span class="p">,</span> <span class="nx">item</span><span class="p">,</span> <span class="nx">user</span><span class="p">)</span> <span class="p">{</span></pre></div></td></tr><tr id="section-8"><td class="docs"><div class="pilwrap"><a href="#section-8" class="pilcrow">&#182;</a></div><p>remove item from items locally</p>
</td><td class="code"><div class="highlight"><pre>      <span class="nx">items</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">items</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">item</span><span class="p">),</span> <span class="mi">1</span><span class="p">);</span></pre></div></td></tr><tr id="section-9"><td class="docs"><div class="pilwrap"><a href="#section-9" class="pilcrow">&#182;</a></div><p>add to db</p>
</td><td class="code"><div class="highlight"><pre>      <span class="nx">$http</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/api/carts/name/&#39;</span> <span class="o">+</span> <span class="nx">user</span><span class="p">,</span> <span class="nx">items</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">success</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;successful res from client&#39;</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span>

        <span class="p">})</span>
        <span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;ERROR REMOVING ITEM: &quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
        <span class="p">});</span>

      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">items</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">items</span><span class="p">;</span>
    <span class="p">};</span></pre></div></td></tr><tr id="section-10"><td class="docs"><div class="pilwrap"><a href="#section-10" class="pilcrow">&#182;</a></div><p>calculate price of items in local cart</p>
</td><td class="code"><div class="highlight"><pre>    <span class="nx">cart</span><span class="p">.</span><span class="nx">totalCharge</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">items</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">totalCharge</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">items</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">totalCharge</span> <span class="o">=</span> <span class="nx">totalCharge</span> <span class="o">+</span> <span class="nb">parseFloat</span><span class="p">(</span><span class="nx">items</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">price</span><span class="p">);</span>
      <span class="p">}</span>

      <span class="k">return</span> <span class="nx">totalCharge</span><span class="p">.</span><span class="nx">toFixed</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
    <span class="p">};</span>

    <span class="nx">cart</span><span class="p">.</span><span class="nx">getItems</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">user</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">$http</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/api/carts/name/&#39;</span> <span class="o">+</span> <span class="nx">user</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">success</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
          <span class="k">return</span> <span class="nx">data</span>
        <span class="p">})</span>
        <span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;ERROR: &quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
        <span class="p">})</span>

    <span class="p">};</span></pre></div></td></tr><tr id="section-11"><td class="docs"><div class="pilwrap"><a href="#section-11" class="pilcrow">&#182;</a></div><p>clear items for user locally and in db</p>
</td><td class="code"><div class="highlight"><pre>    <span class="nx">cart</span><span class="p">.</span><span class="nx">dropSchema</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">user</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">$http</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="s1">&#39;/api/carts/name/&#39;</span> <span class="o">+</span> <span class="nx">user</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">success</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">msg</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Success dropping Schema: &#39;</span><span class="p">,</span> <span class="nx">msg</span><span class="p">);</span>
        <span class="p">})</span>
        <span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Error: &#39;</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
        <span class="p">})</span>
    <span class="p">};</span></pre></div></td></tr><tr id="section-12"><td class="docs"><div class="pilwrap"><a href="#section-12" class="pilcrow">&#182;</a></div><p>return the CartFactory object</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-13"><td class="docs"><div class="pilwrap"><a href="#section-13" class="pilcrow">&#182;</a></div><p>//AMAZON CART FUNCTIONALITY</p>
</td><td class="code"><div class="highlight"><pre>    <span class="nx">cart</span><span class="p">.</span><span class="nx">amazonGetCart</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">cartId</span><span class="p">,</span> <span class="nx">HMAC</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;FROM FACTORY WHEN GETTING CART + HMAC &quot;</span><span class="p">,</span> <span class="nx">cartId</span><span class="p">,</span> <span class="nx">HMAC</span><span class="p">)</span>

      <span class="nx">$http</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/api/amazoncarts/get&#39;</span><span class="p">,</span> <span class="p">{</span>
          <span class="s1">&#39;cartId&#39;</span><span class="o">:</span> <span class="nx">cartId</span><span class="p">,</span>
          <span class="s1">&#39;HMAC&#39;</span><span class="o">:</span> <span class="nx">HMAC</span>
        <span class="p">})</span>
        <span class="p">.</span><span class="nx">success</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;cart from AMAZON:  &#39;</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>

        <span class="p">})</span>
        <span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;ERROR getting Cart &quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
        <span class="p">});</span>
    <span class="p">}</span>
    <span class="nx">cart</span><span class="p">.</span><span class="nx">amazonRemoveProduct</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">product</span><span class="p">,</span> <span class="nx">amazonCart</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;A SUBTRACT Remove PRODCUT&quot;</span><span class="p">,</span> <span class="nx">amazonCart</span><span class="p">)</span>

      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">amazonCart</span><span class="p">.</span><span class="nx">items</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">product</span> <span class="o">===</span> <span class="nx">amazonCart</span><span class="p">.</span><span class="nx">items</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="s1">&#39;productId&#39;</span><span class="p">])</span> <span class="p">{</span>
          <span class="nx">newquantity</span> <span class="o">=</span> <span class="o">--</span><span class="nx">amazonCart</span><span class="p">.</span><span class="nx">items</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="s1">&#39;quantity&#39;</span><span class="p">]</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>

      <span class="p">}</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;WHEN BLESSED ITEM&#39;</span><span class="p">,</span> <span class="nx">amazonCart</span><span class="p">[</span><span class="s1">&#39;CartId&#39;</span><span class="p">])</span>
      <span class="nx">$http</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/api/amazoncarts/modify&#39;</span><span class="p">,</span> <span class="p">{</span>
          <span class="s1">&#39;id&#39;</span><span class="o">:</span> <span class="nx">product</span><span class="p">,</span>
          <span class="s1">&#39;productId&#39;</span><span class="o">:</span> <span class="nx">product</span><span class="p">,</span>
          <span class="s1">&#39;CartId&#39;</span><span class="o">:</span> <span class="nx">amazonCart</span><span class="p">[</span><span class="s1">&#39;CartId&#39;</span><span class="p">],</span>
          <span class="s1">&#39;HMAC&#39;</span><span class="o">:</span> <span class="nx">amazonCart</span><span class="p">[</span><span class="s1">&#39;HMAC&#39;</span><span class="p">],</span>
          <span class="s1">&#39;newquantity&#39;</span><span class="o">:</span> <span class="nx">newquantity</span>
        <span class="p">})</span>
        <span class="p">.</span><span class="nx">success</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;successful res from AMAZON client&#39;</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span>
        <span class="p">})</span>
        <span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;ERROR creating Cart &quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
        <span class="p">});</span>

    <span class="p">}</span>



    <span class="nx">cart</span><span class="p">.</span><span class="nx">amazonAddProduct</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">product</span><span class="p">,</span> <span class="nx">amazonCart</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;A CART FROM ADD PRODCUT&quot;</span><span class="p">,</span> <span class="nx">amazonCart</span><span class="p">)</span>

      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">amazonCart</span><span class="p">.</span><span class="nx">items</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">product</span> <span class="o">===</span> <span class="nx">amazonCart</span><span class="p">.</span><span class="nx">items</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="s1">&#39;productId&#39;</span><span class="p">])</span> <span class="p">{</span>
          <span class="nx">newquantity</span> <span class="o">=</span> <span class="o">++</span><span class="nx">amazonCart</span><span class="p">.</span><span class="nx">items</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="s1">&#39;quantity&#39;</span><span class="p">]</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="nx">newquantity</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>

      <span class="p">}</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;WHEN ADDING ITEM&#39;</span><span class="p">,</span> <span class="nx">amazonCart</span><span class="p">[</span><span class="s1">&#39;CartId&#39;</span><span class="p">],</span> <span class="nx">newquantity</span><span class="p">)</span>
      <span class="nx">$http</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/api/amazoncarts/modify&#39;</span><span class="p">,</span> <span class="p">{</span>
          <span class="s1">&#39;id&#39;</span><span class="o">:</span> <span class="nx">product</span><span class="p">,</span>
          <span class="s1">&#39;productId&#39;</span><span class="o">:</span> <span class="nx">product</span><span class="p">,</span>
          <span class="s1">&#39;CartId&#39;</span><span class="o">:</span> <span class="nx">amazonCart</span><span class="p">[</span><span class="s1">&#39;CartId&#39;</span><span class="p">],</span>
          <span class="s1">&#39;HMAC&#39;</span><span class="o">:</span> <span class="nx">amazonCart</span><span class="p">[</span><span class="s1">&#39;HMAC&#39;</span><span class="p">],</span>
          <span class="s1">&#39;newquantity&#39;</span><span class="o">:</span> <span class="nx">newquantity</span>
        <span class="p">})</span>
        <span class="p">.</span><span class="nx">success</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;successful res from AMAZON client&#39;</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span>
        <span class="p">})</span>
        <span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;ERROR creating Cart &quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
        <span class="p">});</span>

    <span class="p">}</span>
    <span class="nx">cart</span><span class="p">.</span><span class="nx">amazonCreateCart</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">itemId</span><span class="p">)</span> <span class="p">{</span></pre></div></td></tr><tr id="section-14"><td class="docs"><div class="pilwrap"><a href="#section-14" class="pilcrow">&#182;</a></div><p>console.log(Auth.getCurrentUser().id)</p>
</td><td class="code"><div class="highlight"><pre>      <span class="nx">$http</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/api/amazoncarts/create&#39;</span><span class="p">,</span> <span class="p">{</span>
          <span class="s1">&#39;id&#39;</span><span class="o">:</span> <span class="nx">itemId</span>
        <span class="p">})</span>
        <span class="p">.</span><span class="nx">success</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;successful res from AMAZON client&#39;</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;WHEN CREATING CART ID:&quot;</span><span class="p">,</span> <span class="nx">data</span><span class="p">.</span><span class="nx">CartId</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
          <span class="nx">cart</span><span class="p">.</span><span class="nx">amazonCart</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;CartId&quot;</span><span class="o">:</span> <span class="nx">data</span><span class="p">.</span><span class="nx">CartId</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="s2">&quot;HMAC&quot;</span><span class="o">:</span> <span class="nx">data</span><span class="p">.</span><span class="nx">HMAC</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="s2">&quot;items&quot;</span><span class="o">:</span> <span class="p">[]</span>
          <span class="p">};</span>
          <span class="nx">cart</span><span class="p">.</span><span class="nx">amazonCart</span><span class="p">.</span><span class="nx">items</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
              <span class="s2">&quot;title&quot;</span><span class="o">:</span> <span class="nx">data</span><span class="p">.</span><span class="nx">CartItems</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">CartItem</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">Title</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
              <span class="s2">&quot;price&quot;</span><span class="o">:</span> <span class="nx">data</span><span class="p">.</span><span class="nx">CartItems</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">CartItem</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">Price</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">FormattedPrice</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
              <span class="s2">&quot;productId&quot;</span><span class="o">:</span> <span class="nx">data</span><span class="p">.</span><span class="nx">CartItems</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">CartItem</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">ASIN</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
              <span class="s2">&quot;quantity&quot;</span><span class="o">:</span> <span class="mi">1</span>
            <span class="p">})</span></pre></div></td></tr><tr id="section-15"><td class="docs"><div class="pilwrap"><a href="#section-15" class="pilcrow">&#182;</a></div><p>console.log("HMAC", data.HMAC[0])</p>
</td><td class="code"><div class="highlight"><pre>          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Title:&quot;</span><span class="p">,</span> <span class="nx">data</span><span class="p">.</span><span class="nx">CartItems</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">CartItem</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">Title</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Item Price:&quot;</span><span class="p">,</span> <span class="nx">data</span><span class="p">.</span><span class="nx">CartItems</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">CartItem</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">Price</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">FormattedPrice</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span></pre></div></td></tr><tr id="section-16"><td class="docs"><div class="pilwrap"><a href="#section-16" class="pilcrow">&#182;</a></div><p>console.log()</p>
</td><td class="code"><div class="highlight"><pre>        <span class="p">})</span>
        <span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;ERROR creating Cart &quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
        <span class="p">});</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">cart</span><span class="p">;</span>
  <span class="p">}]);</span>

</pre></div></td></tr></tbody></table><div id="generated">generated Thu Feb 19 2015 15:13:31 GMT-0800 (PST)  </div><div id="projectname"><a href="../../../index.html">thesisApp</a></div></div></body></html>